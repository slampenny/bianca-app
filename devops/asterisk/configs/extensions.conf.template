[from-twilio]
exten => _.,1,NoOp(Catch-all extension in from-twilio)
 same => n,Verbose(1, Received call to: ${EXTEN})
 
 ; Extract the entire SIP URI from the Request-Line instead of To header
 same => n,Set(REQ_LINE=${PJSIP_HEADER(read,Request-Line)})
 same => n,Verbose(1, Request-Line: ${REQ_LINE})
 
 ; Try to extract callSid parameter using regex
 same => n,Set(CALLSID_MATCH=${REGEX("callSid=([^;& ]+)",${REQ_LINE})})
 same => n,Set(CALLSID_VALUE=${REGEX_REPLACE(${CALLSID_MATCH},"callSid=","")})
 
 ; Try to extract patientId parameter using regex
 same => n,Set(PATIENTID_MATCH=${REGEX("patientId=([^;& ]+)",${REQ_LINE})})
 same => n,Set(PATIENTID_VALUE=${REGEX_REPLACE(${PATIENTID_MATCH},"patientId=","")})
 
 same => n,Verbose(1, Extracted CallSid: ${CALLSID_VALUE})
 same => n,Verbose(1, Extracted PatientId: ${PATIENTID_VALUE})
 
 ; Construct URI options
 same => n,Set(URIOPTS=callSid=${CALLSID_VALUE}&patientId=${PATIENTID_VALUE})
 same => n,Verbose(1, URIOPTS: ${URIOPTS})
 
 ; Send to Stasis
 same => n,Stasis(myphonefriend)
 same => n,Hangup()

[bianca-app]
exten => _X.,1,NoOp(Outgoing call from Bianca: ${EXTEN})
 same => n,Dial(PJSIP/${EXTEN}@twilio-trunk)
 same => n,Hangup()

[unauthorized]
exten => _X.,1,NoOp(ğŸš« Unauthorized SIP attempt from ${CALLERID(all)})
 same => n,Hangup()

