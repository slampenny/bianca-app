# MongoDB configuration for PRODUCTION - HIPAA Compliant
# ⚠️ CRITICAL: This configuration enables encryption at rest for HIPAA compliance

# Logging
systemLog:
  destination: file
  path: /var/log/mongodb/mongod.log
  logAppend: true
  verbosity: 0  # Production: minimal logging
  component:
    accessControl:
      verbosity: 1  # Log access control events
    command:
      verbosity: 0
    control:
      verbosity: 0
    network:
      verbosity: 0
    query:
      verbosity: 0
    replication:
      verbosity: 1
    storage:
      verbosity: 0
    write:
      verbosity: 0

# Storage with Encryption at Rest
storage:
  dbPath: /data/db
  journal:
    enabled: true
  engine: wiredTiger
  wiredTiger:
    engineConfig:
      cacheSizeGB: 2
      # HIPAA COMPLIANCE: Journal encryption
      journalCompressor: snappy

# Network
net:
  port: 27017
  bindIp: 127.0.0.1  # Production: only local connections (use with VPC)
  ssl:
    mode: requireSSL  # Require TLS for all connections
    PEMKeyFile: /etc/ssl/mongodb.pem
    CAFile: /etc/ssl/ca.pem

# Process management
processManagement:
  fork: true
  pidFilePath: /var/run/mongodb/mongod.pid

# Security - HIPAA Compliant
security:
  authorization: enabled
  # HIPAA COMPLIANCE: Encryption at rest
  # Note: MongoDB Enterprise feature
  # For MongoDB Atlas, configure in the Atlas console
  enableEncryption: true
  encryptionKeyFile: /etc/mongodb-keyfile
  encryptionCipherMode: AES256-CBC
  # Key management options:
  # - Local key file (above)
  # - AWS KMS (recommended for production)
  # - Azure Key Vault
  # - Google Cloud KMS
  
  # For AWS KMS (recommended):
  # kmip:
  #   serverName: kms.us-east-2.amazonaws.com
  #   port: 5696
  #   clientCertificateFile: /etc/mongodb-kmip-client.pem
  #   serverCAFile: /etc/mongodb-kmip-ca.pem

# Replication (for high availability)
# replication:
#   replSetName: bianca-prod-rs

# Audit logging (MongoDB Enterprise)
auditLog:
  destination: file
  format: JSON
  path: /var/log/mongodb/audit.log
  filter: '{ atype: { $in: [ "authenticate", "authCheck", "createCollection", "createDatabase", "createIndex", "renameCollection", "dropCollection", "dropDatabase", "dropIndex", "createUser", "dropUser", "dropAllUsersFromDatabase", "updateUser", "grantRolesToUser", "revokeRolesFromUser", "createRole", "updateRole", "dropRole", "dropAllRolesFromDatabase", "grantRolesToRole", "revokeRolesFromRole", "grantPrivilegesToRole", "revokePrivilegesFromRole", "replSetReconfig", "enableSharding", "shardCollection", "addShard", "removeShard", "shutdown", "applicationMessage" ] } }'

# Operation profiling (for performance monitoring)
operationProfiling:
  mode: slowOp
  slowOpThresholdMs: 100

